# ğŸš€ CMake è¿›é˜¶å­¦ä¹ è·¯çº¿

## æ¦‚è¿°

æ­å–œä½ å®Œæˆäº†åŸºç¡€é¡¹ç›®çš„å­¦ä¹ !ç°åœ¨ä½ å·²ç»æŒæ¡äº† CMake çš„æ ¸å¿ƒæ¦‚å¿µã€‚æœ¬æ–‡æ¡£å°†æŒ‡å¯¼ä½ å¦‚ä½•é€šè¿‡æ”¹è¿›è¿™ä¸ªé¡¹ç›®æ¥æ·±å…¥ç†è§£ CMake çš„é«˜çº§ç‰¹æ€§ã€‚

## ğŸ“‹ ç›®å½•

1. [è¿›é˜¶æ–¹å‘æ€»è§ˆ](#è¿›é˜¶æ–¹å‘æ€»è§ˆ)
2. [é˜¶æ®µä¸€: ç°ä»£ CMake å®è·µ](#é˜¶æ®µä¸€-ç°ä»£-cmake-å®è·µ)
3. [é˜¶æ®µäºŒ: ä¾èµ–ç®¡ç†](#é˜¶æ®µäºŒ-ä¾èµ–ç®¡ç†)
4. [é˜¶æ®µä¸‰: è·¨å¹³å°æ„å»º](#é˜¶æ®µä¸‰-è·¨å¹³å°æ„å»º)
5. [é˜¶æ®µå››: åŒ…ç®¡ç†ä¸åˆ†å‘](#é˜¶æ®µå››-åŒ…ç®¡ç†ä¸åˆ†å‘)
6. [é˜¶æ®µäº”: é«˜çº§ç‰¹æ€§](#é˜¶æ®µäº”-é«˜çº§ç‰¹æ€§)
7. [é˜¶æ®µå…­: å·¥ç¨‹åŒ–å®è·µ](#é˜¶æ®µå…­-å·¥ç¨‹åŒ–å®è·µ)

---

## è¿›é˜¶æ–¹å‘æ€»è§ˆ

### å­¦ä¹ è·¯å¾„å›¾

```
åŸºç¡€é¡¹ç›® (å·²å®Œæˆ)
    â†“
â”œâ”€â†’ ç°ä»£ CMake å®è·µ (1-2å¤©)
â”‚   â”œâ”€ ç›®æ ‡å±æ€§ä¼ æ’­
â”‚   â”œâ”€ æ¥å£åº“
â”‚   â””â”€ ç”Ÿæˆå™¨è¡¨è¾¾å¼
â”‚
â”œâ”€â†’ ä¾èµ–ç®¡ç† (2-3å¤©)
â”‚   â”œâ”€ FetchContent
â”‚   â”œâ”€ find_package
â”‚   â””â”€ ExternalProject
â”‚
â”œâ”€â†’ è·¨å¹³å°æ„å»º (2-3å¤©)
â”‚   â”œâ”€ å¹³å°æ£€æµ‹
â”‚   â”œâ”€ ç¼–è¯‘å™¨é€‚é…
â”‚   â””â”€ æ¡ä»¶ç¼–è¯‘
â”‚
â”œâ”€â†’ åŒ…ç®¡ç†ä¸åˆ†å‘ (3-4å¤©)
â”‚   â”œâ”€ å¯¼å‡ºç›®æ ‡
â”‚   â”œâ”€ Config æ–‡ä»¶
â”‚   â””â”€ CPack æ‰“åŒ…
â”‚
â”œâ”€â†’ é«˜çº§ç‰¹æ€§ (3-5å¤©)
â”‚   â”œâ”€ è‡ªå®šä¹‰å‘½ä»¤
â”‚   â”œâ”€ ä»£ç ç”Ÿæˆ
â”‚   â””â”€ é¢„ç¼–è¯‘å¤´
â”‚
â””â”€â†’ å·¥ç¨‹åŒ–å®è·µ (æŒç»­)
    â”œâ”€ CI/CD é›†æˆ
    â”œâ”€ æ–‡æ¡£ç”Ÿæˆ
    â””â”€ æ€§èƒ½ä¼˜åŒ–
```

---

## é˜¶æ®µä¸€: ç°ä»£ CMake å®è·µ

### ç›®æ ‡
å°†é¡¹ç›®å‡çº§ä¸ºå®Œå…¨ç¬¦åˆç°ä»£ CMake æ ‡å‡†(CMake 3.15+)çš„é¡¹ç›®ã€‚

### æ”¹è¿› 1: ä½¿ç”¨ç›®æ ‡å±æ€§è€Œéå…¨å±€å˜é‡

**å½“å‰åšæ³•**:
```cmake
include_directories(${PROJECT_SOURCE_DIR}/include)
```

**æ”¹è¿›ä¸º**:
```cmake
# ä¸ºæ¯ä¸ªåº“å•ç‹¬è®¾ç½®
target_include_directories(mathlib PUBLIC
    $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/../../include>
    $<INSTALL_INTERFACE:include>
)
```

**å­¦ä¹ è¦ç‚¹**:
- ç†è§£ `BUILD_INTERFACE` å’Œ `INSTALL_INTERFACE` çš„åŒºåˆ«
- æŒæ¡ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„ä½¿ç”¨
- ç†è§£ç›®æ ‡å±æ€§çš„ä¼ æ’­æœºåˆ¶

### æ”¹è¿› 2: åˆ›å»ºæ¥å£åº“(Interface Library)

**æ–°å¢å†…å®¹**: åˆ›å»ºä¸€ä¸ªç¼–è¯‘é€‰é¡¹æ¥å£åº“

```cmake
# åˆ›å»ºç¼–è¯‘é€‰é¡¹æ¥å£åº“
add_library(compiler_warnings INTERFACE)
target_compile_options(compiler_warnings INTERFACE
    $<$<CXX_COMPILER_ID:GNU>:-Wall -Wextra -Wpedantic>
    $<$<CXX_COMPILER_ID:MSVC>:/W4>
    $<$<CXX_COMPILER_ID:Clang>:-Wall -Wextra -Wpedantic>
)

# å…¶ä»–ç›®æ ‡é“¾æ¥è¿™ä¸ªæ¥å£åº“
target_link_libraries(mathlib PRIVATE compiler_warnings)
```

**å­¦ä¹ è¦ç‚¹**:
- æ¥å£åº“çš„æ¦‚å¿µå’Œç”¨é€”
- å¦‚ä½•å¤ç”¨ç¼–è¯‘é€‰é¡¹
- ç”Ÿæˆå™¨è¡¨è¾¾å¼çš„é«˜çº§ç”¨æ³•

### æ”¹è¿› 3: ä½¿ç”¨ target_sources()

**æ”¹è¿›å‰**:
```cmake
set(MATHLIB_SOURCES
    calculator.cpp
    statistics.cpp
)
add_library(mathlib ${MATHLIB_SOURCES})
```

**æ”¹è¿›å**:
```cmake
add_library(mathlib)
target_sources(mathlib
    PRIVATE
        calculator.cpp
        statistics.cpp
    PUBLIC
        FILE_SET HEADERS
        BASE_DIRS ${PROJECT_SOURCE_DIR}/include
        FILES
            ${PROJECT_SOURCE_DIR}/include/mathlib/calculator.h
            ${PROJECT_SOURCE_DIR}/include/mathlib/statistics.h
)
```

**å­¦ä¹ è¦ç‚¹**:
- `target_sources()` çš„ä¼˜åŠ¿
- FILE_SET çš„ä½¿ç”¨(CMake 3.23+)
- å¤´æ–‡ä»¶çš„æ­£ç¡®ç®¡ç†æ–¹å¼

### å®è·µä»»åŠ¡

- [ ] ç§»é™¤æ‰€æœ‰å…¨å±€çš„ `include_directories()`
- [ ] ä¸ºæ¯ä¸ªåº“æ·»åŠ æ­£ç¡®çš„ `target_include_directories()`
- [ ] åˆ›å»ºç¼–è¯‘é€‰é¡¹æ¥å£åº“
- [ ] ä½¿ç”¨ `target_sources()` ç®¡ç†æºæ–‡ä»¶

---

## é˜¶æ®µäºŒ: ä¾èµ–ç®¡ç†

### ç›®æ ‡
å­¦ä¹ å¦‚ä½•åœ¨ CMake é¡¹ç›®ä¸­é›†æˆå’Œç®¡ç†ç¬¬ä¸‰æ–¹åº“ã€‚

### æ”¹è¿› 4: ä½¿ç”¨ FetchContent æ·»åŠ ä¾èµ–

**ä»»åŠ¡**: é›†æˆ Google Test æµ‹è¯•æ¡†æ¶

```cmake
include(FetchContent)

FetchContent_Declare(
    googletest
    GIT_REPOSITORY https://github.com/google/googletest.git
    GIT_TAG v1.14.0
)

# è®¾ç½®é€‰é¡¹
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)
```

**ç„¶åæ”¹å†™æµ‹è¯•**:
```cpp
#include <gtest/gtest.h>
#include "mathlib/calculator.h"

TEST(CalculatorTest, Addition) {
    EXPECT_EQ(Calculator::add(2, 3), 5);
    EXPECT_EQ(Calculator::add(-1, 1), 0);
}
```

**å­¦ä¹ è¦ç‚¹**:
- FetchContent çš„å·¥ä½œåŸç†
- å¦‚ä½•ç®¡ç†ä¾èµ–ç‰ˆæœ¬
- ä¾èµ–çš„ç¼“å­˜æœºåˆ¶

### æ”¹è¿› 5: é›†æˆ JSON åº“

**ä»»åŠ¡**: æ·»åŠ é…ç½®æ–‡ä»¶è¯»å–åŠŸèƒ½

```cmake
FetchContent_Declare(
    json
    GIT_REPOSITORY https://github.com/nlohmann/json.git
    GIT_TAG v3.11.2
)
FetchContent_MakeAvailable(json)

target_link_libraries(calculator_app PRIVATE nlohmann_json::nlohmann_json)
```

**æ–°å¢åŠŸèƒ½**: ä» JSON æ–‡ä»¶è¯»å–é…ç½®

```cpp
#include <nlohmann/json.hpp>
#include <fstream>

void loadConfig(const std::string& filename) {
    std::ifstream file(filename);
    nlohmann::json config = nlohmann::json::parse(file);
    // ä½¿ç”¨é…ç½®...
}
```

### æ”¹è¿› 6: ä½¿ç”¨ find_package() æŸ¥æ‰¾ç³»ç»Ÿåº“

**ä»»åŠ¡**: æ·»åŠ  Boost åº“æ”¯æŒ

```cmake
find_package(Boost 1.70 COMPONENTS filesystem)

if(Boost_FOUND)
    target_link_libraries(myapp PRIVATE Boost::filesystem)
    target_compile_definitions(myapp PRIVATE HAS_BOOST)
endif()
```

**å­¦ä¹ è¦ç‚¹**:
- `find_package()` çš„ä¸¤ç§æ¨¡å¼(Module å’Œ Config)
- å¦‚ä½•ç¼–å†™ FindXXX.cmake æ¨¡å—
- IMPORTED ç›®æ ‡çš„ä½¿ç”¨

### å®è·µä»»åŠ¡

- [ ] ä½¿ç”¨ Google Test é‡å†™æ‰€æœ‰æµ‹è¯•
- [ ] é›†æˆ nlohmann/json åº“
- [ ] æ·»åŠ é…ç½®æ–‡ä»¶è¯»å–åŠŸèƒ½
- [ ] å°è¯•æŸ¥æ‰¾å¹¶ä½¿ç”¨ç³»ç»Ÿåº“(å¦‚ Boost)

---

## é˜¶æ®µä¸‰: è·¨å¹³å°æ„å»º

### ç›®æ ‡
ä½¿é¡¹ç›®èƒ½å¤Ÿåœ¨ Windowsã€Linuxã€macOS ä¸Šæ­£ç¡®æ„å»ºå’Œè¿è¡Œã€‚

### æ”¹è¿› 7: å¹³å°æ£€æµ‹å’Œé€‚é…

```cmake
# æ£€æµ‹æ“ä½œç³»ç»Ÿ
if(WIN32)
    message(STATUS "é…ç½® Windows å¹³å°")
    target_compile_definitions(myapp PRIVATE PLATFORM_WINDOWS)
elseif(APPLE)
    message(STATUS "é…ç½® macOS å¹³å°")
    target_compile_definitions(myapp PRIVATE PLATFORM_MACOS)
elseif(UNIX)
    message(STATUS "é…ç½® Linux å¹³å°")
    target_compile_definitions(myapp PRIVATE PLATFORM_LINUX)
endif()

# æ£€æµ‹ç¼–è¯‘å™¨
if(CMAKE_CXX_COMPILER_ID STREQUAL "MSVC")
    target_compile_options(myapp PRIVATE /utf-8)
elseif(CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
    target_compile_options(myapp PRIVATE -fPIC)
endif()
```

### æ”¹è¿› 8: å¤„ç†å¹³å°å·®å¼‚

**åˆ›å»ºå¹³å°æŠ½è±¡å±‚**:

```cpp
// platform.h
#ifdef PLATFORM_WINDOWS
    #define PATH_SEPARATOR "\\"
    #include <windows.h>
#else
    #define PATH_SEPARATOR "/"
    #include <unistd.h>
#endif

class Platform {
public:
    static std::string getExecutablePath();
    static void sleep(int milliseconds);
};
```

### æ”¹è¿› 9: åŠŸèƒ½æ£€æµ‹

```cmake
include(CheckCXXSourceCompiles)

# æ£€æµ‹ C++17 filesystem
check_cxx_source_compiles("
    #include <filesystem>
    int main() {
        std::filesystem::path p;
        return 0;
    }
" HAS_STD_FILESYSTEM)

if(HAS_STD_FILESYSTEM)
    target_compile_definitions(myapp PRIVATE HAS_STD_FILESYSTEM)
else()
    # ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ
    target_link_libraries(myapp PRIVATE stdc++fs)
endif()
```

### å®è·µä»»åŠ¡

- [ ] æ·»åŠ å¹³å°æ£€æµ‹ä»£ç 
- [ ] åˆ›å»ºå¹³å°æŠ½è±¡å±‚
- [ ] å¤„ç†ä¸åŒå¹³å°çš„è·¯å¾„åˆ†éš”ç¬¦
- [ ] åœ¨ Windows å’Œ Linux ä¸Šæµ‹è¯•æ„å»º

---

## é˜¶æ®µå››: åŒ…ç®¡ç†ä¸åˆ†å‘

### ç›®æ ‡
ä½¿ä½ çš„åº“å¯ä»¥è¢«å…¶ä»–é¡¹ç›®è½»æ¾ä½¿ç”¨ã€‚

### æ”¹è¿› 10: å¯¼å‡ºç›®æ ‡

```cmake
# å®‰è£…åº“å’Œå¤´æ–‡ä»¶
install(TARGETS mathlib stringlib
    EXPORT MathStringTargets
    LIBRARY DESTINATION lib
    ARCHIVE DESTINATION lib
    RUNTIME DESTINATION bin
    INCLUDES DESTINATION include
)

install(DIRECTORY include/
    DESTINATION include
    FILES_MATCHING PATTERN "*.h"
)

# å¯¼å‡ºç›®æ ‡
install(EXPORT MathStringTargets
    FILE MathStringTargets.cmake
    NAMESPACE MathString::
    DESTINATION lib/cmake/MathString
)
```

### æ”¹è¿› 11: ç”Ÿæˆ Config æ–‡ä»¶

```cmake
include(CMakePackageConfigHelpers)

# ç”Ÿæˆç‰ˆæœ¬æ–‡ä»¶
write_basic_package_version_file(
    "${CMAKE_CURRENT_BINARY_DIR}/MathStringConfigVersion.cmake"
    VERSION ${PROJECT_VERSION}
    COMPATIBILITY AnyNewerVersion
)

# é…ç½® Config æ–‡ä»¶
configure_package_config_file(
    "${CMAKE_CURRENT_SOURCE_DIR}/Config.cmake.in"
    "${CMAKE_CURRENT_BINARY_DIR}/MathStringConfig.cmake"
    INSTALL_DESTINATION lib/cmake/MathString
)

# å®‰è£…é…ç½®æ–‡ä»¶
install(FILES
    "${CMAKE_CURRENT_BINARY_DIR}/MathStringConfig.cmake"
    "${CMAKE_CURRENT_BINARY_DIR}/MathStringConfigVersion.cmake"
    DESTINATION lib/cmake/MathString
)
```

### æ”¹è¿› 12: ä½¿ç”¨ CPack æ‰“åŒ…

```cmake
include(CPack)

set(CPACK_PACKAGE_NAME "MathStringLib")
set(CPACK_PACKAGE_VENDOR "Your Name")
set(CPACK_PACKAGE_DESCRIPTION_SUMMARY "Math and String Libraries")
set(CPACK_PACKAGE_VERSION ${PROJECT_VERSION})
set(CPACK_PACKAGE_INSTALL_DIRECTORY "MathString")

# ä¸åŒå¹³å°çš„æ‰“åŒ…æ ¼å¼
if(WIN32)
    set(CPACK_GENERATOR "ZIP;NSIS")
elseif(APPLE)
    set(CPACK_GENERATOR "TGZ;DragNDrop")
else()
    set(CPACK_GENERATOR "TGZ;DEB;RPM")
endif()
```

**ä½¿ç”¨**:
```bash
cmake --build . --target package
```

### æ”¹è¿› 13: åˆ›å»ºå¯è¢«å…¶ä»–é¡¹ç›®ä½¿ç”¨çš„åº“

**å…¶ä»–é¡¹ç›®ä½¿ç”¨ä½ çš„åº“**:
```cmake
find_package(MathString 1.0 REQUIRED)

add_executable(myapp main.cpp)
target_link_libraries(myapp PRIVATE MathString::mathlib)
```

### å®è·µä»»åŠ¡

- [ ] æ·»åŠ å®Œæ•´çš„å®‰è£…è§„åˆ™
- [ ] ç”Ÿæˆå¯¼å‡ºæ–‡ä»¶
- [ ] åˆ›å»º Config.cmake.in æ¨¡æ¿
- [ ] é…ç½® CPack æ‰“åŒ…
- [ ] åˆ›å»ºæµ‹è¯•é¡¹ç›®éªŒè¯å¯¼å‡ºçš„åº“å¯ç”¨

---

## é˜¶æ®µäº”: é«˜çº§ç‰¹æ€§

### ç›®æ ‡
æŒæ¡ CMake çš„é«˜çº§åŠŸèƒ½,æå‡æ„å»ºæ•ˆç‡ã€‚

### æ”¹è¿› 14: ä»£ç ç”Ÿæˆ

**ä»»åŠ¡**: ä½¿ç”¨ Python è„šæœ¬ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯

```cmake
# æ·»åŠ è‡ªå®šä¹‰å‘½ä»¤
add_custom_command(
    OUTPUT ${CMAKE_BINARY_DIR}/version.cpp
    COMMAND ${Python3_EXECUTABLE} 
        ${CMAKE_SOURCE_DIR}/scripts/generate_version.py
        --version ${PROJECT_VERSION}
        --output ${CMAKE_BINARY_DIR}/version.cpp
    DEPENDS ${CMAKE_SOURCE_DIR}/scripts/generate_version.py
    COMMENT "ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯..."
)

add_library(version ${CMAKE_BINARY_DIR}/version.cpp)
```

### æ”¹è¿› 15: é¢„ç¼–è¯‘å¤´(PCH)

```cmake
# ä¸ºåº“æ·»åŠ é¢„ç¼–è¯‘å¤´
target_precompile_headers(mathlib
    PRIVATE
        <vector>
        <string>
        <algorithm>
        <cmath>
)

# å¤ç”¨é¢„ç¼–è¯‘å¤´
target_precompile_headers(stringlib REUSE_FROM mathlib)
```

**å­¦ä¹ è¦ç‚¹**:
- é¢„ç¼–è¯‘å¤´çš„åŸç†
- ä½•æ—¶ä½¿ç”¨é¢„ç¼–è¯‘å¤´
- å¦‚ä½•åœ¨å¤šä¸ªç›®æ ‡é—´å…±äº« PCH

### æ”¹è¿› 16: å¯¹è±¡åº“(Object Library)

```cmake
# åˆ›å»ºå¯¹è±¡åº“
add_library(mathlib_objects OBJECT
    calculator.cpp
    statistics.cpp
)

# ä»å¯¹è±¡åº“åˆ›å»ºé™æ€åº“å’Œå…±äº«åº“
add_library(mathlib_static STATIC $<TARGET_OBJECTS:mathlib_objects>)
add_library(mathlib_shared SHARED $<TARGET_OBJECTS:mathlib_objects>)
```

**å­¦ä¹ è¦ç‚¹**:
- å¯¹è±¡åº“çš„ç”¨é€”
- é¿å…é‡å¤ç¼–è¯‘
- åŒæ—¶ç”Ÿæˆé™æ€åº“å’Œå…±äº«åº“

### æ”¹è¿› 17: è‡ªå®šä¹‰ç›®æ ‡

```cmake
# æ·»åŠ ä»£ç æ ¼å¼åŒ–ç›®æ ‡
find_program(CLANG_FORMAT clang-format)
if(CLANG_FORMAT)
    add_custom_target(format
        COMMAND ${CLANG_FORMAT} -i
            ${CMAKE_SOURCE_DIR}/src/**/*.cpp
            ${CMAKE_SOURCE_DIR}/include/**/*.h
        COMMENT "æ ¼å¼åŒ–ä»£ç ..."
    )
endif()

# æ·»åŠ é™æ€åˆ†æç›®æ ‡
add_custom_target(analyze
    COMMAND cppcheck --enable=all ${CMAKE_SOURCE_DIR}/src
    COMMENT "è¿è¡Œé™æ€åˆ†æ..."
)
```

### å®è·µä»»åŠ¡

- [ ] æ·»åŠ ç‰ˆæœ¬ä¿¡æ¯ç”Ÿæˆè„šæœ¬
- [ ] ä¸ºä¸»è¦åº“æ·»åŠ é¢„ç¼–è¯‘å¤´
- [ ] åˆ›å»ºå¯¹è±¡åº“å¹¶ç”Ÿæˆå¤šç§åº“ç±»å‹
- [ ] æ·»åŠ ä»£ç æ ¼å¼åŒ–å’Œé™æ€åˆ†æç›®æ ‡

---

## é˜¶æ®µå…­: å·¥ç¨‹åŒ–å®è·µ

### ç›®æ ‡
å°†é¡¹ç›®æå‡åˆ°ç”Ÿäº§çº§åˆ«çš„å·¥ç¨‹æ ‡å‡†ã€‚

### æ”¹è¿› 18: CI/CD é›†æˆ

**åˆ›å»º `.github/workflows/cmake.yml`**:

```yaml
name: CMake Build

on: [push, pull_request]

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        build_type: [Debug, Release]
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Configure CMake
      run: cmake -B build -DCMAKE_BUILD_TYPE=${{ matrix.build_type }}
    
    - name: Build
      run: cmake --build build --config ${{ matrix.build_type }}
    
    - name: Test
      run: cd build && ctest -C ${{ matrix.build_type }}
```

### æ”¹è¿› 19: æ–‡æ¡£ç”Ÿæˆ(Doxygen)

```cmake
find_package(Doxygen)

if(DOXYGEN_FOUND)
    set(DOXYGEN_GENERATE_HTML YES)
    set(DOXYGEN_GENERATE_MAN NO)
    
    doxygen_add_docs(docs
        ${PROJECT_SOURCE_DIR}/include
        ${PROJECT_SOURCE_DIR}/src
        COMMENT "ç”Ÿæˆ API æ–‡æ¡£"
    )
endif()
```

### æ”¹è¿› 20: ä»£ç è¦†ç›–ç‡

```cmake
option(ENABLE_COVERAGE "å¯ç”¨ä»£ç è¦†ç›–ç‡" OFF)

if(ENABLE_COVERAGE)
    target_compile_options(mathlib PRIVATE --coverage)
    target_link_options(mathlib PRIVATE --coverage)
endif()
```

**ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š**:
```bash
cmake -DENABLE_COVERAGE=ON ..
cmake --build .
ctest
lcov --capture --directory . --output-file coverage.info
genhtml coverage.info --output-directory coverage_report
```

### æ”¹è¿› 21: æ€§èƒ½åˆ†æå’Œä¼˜åŒ–

```cmake
# æ·»åŠ æ€§èƒ½åˆ†æé€‰é¡¹
option(ENABLE_PROFILING "å¯ç”¨æ€§èƒ½åˆ†æ" OFF)

if(ENABLE_PROFILING)
    target_compile_options(mathlib PRIVATE -pg)
    target_link_options(mathlib PRIVATE -pg)
endif()

# é“¾æ¥æ—¶ä¼˜åŒ–(LTO)
include(CheckIPOSupported)
check_ipo_supported(RESULT ipo_supported)

if(ipo_supported)
    set_target_properties(mathlib PROPERTIES
        INTERPROCEDURAL_OPTIMIZATION TRUE
    )
endif()
```

### æ”¹è¿› 22: æ·»åŠ  Sanitizers

```cmake
option(ENABLE_ASAN "å¯ç”¨ AddressSanitizer" OFF)
option(ENABLE_UBSAN "å¯ç”¨ UndefinedBehaviorSanitizer" OFF)

if(ENABLE_ASAN)
    target_compile_options(mathlib PRIVATE -fsanitize=address)
    target_link_options(mathlib PRIVATE -fsanitize=address)
endif()

if(ENABLE_UBSAN)
    target_compile_options(mathlib PRIVATE -fsanitize=undefined)
    target_link_options(mathlib PRIVATE -fsanitize=undefined)
endif()
```

### å®è·µä»»åŠ¡

- [ ] é…ç½® GitHub Actions CI
- [ ] é›†æˆ Doxygen æ–‡æ¡£ç”Ÿæˆ
- [ ] æ·»åŠ ä»£ç è¦†ç›–ç‡æ”¯æŒ
- [ ] å¯ç”¨ LTO ä¼˜åŒ–
- [ ] æ·»åŠ  Sanitizers æ”¯æŒ

---

## ç»¼åˆå®æˆ˜é¡¹ç›®

### ç»ˆææŒ‘æˆ˜: åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„æ•°å­¦è®¡ç®—åº“

å°†æ‰€æœ‰å­¦åˆ°çš„çŸ¥è¯†æ•´åˆ,åˆ›å»ºä¸€ä¸ªç”Ÿäº§çº§åˆ«çš„åº“:

**åŠŸèƒ½éœ€æ±‚**:
1. çŸ©é˜µè¿ç®—åº“
2. çº¿æ€§ä»£æ•°æ±‚è§£å™¨
3. æ•°å€¼ç§¯åˆ†
4. ä¼˜åŒ–ç®—æ³•

**æŠ€æœ¯è¦æ±‚**:
1. ä½¿ç”¨ç°ä»£ CMake 3.20+
2. æ”¯æŒ Windows/Linux/macOS
3. é›†æˆ Eigen æˆ– BLAS åº“
4. å®Œæ•´çš„å•å…ƒæµ‹è¯•(Google Test)
5. API æ–‡æ¡£(Doxygen)
6. å¯å¯¼å‡ºä¾›å…¶ä»–é¡¹ç›®ä½¿ç”¨
7. CI/CD è‡ªåŠ¨åŒ–
8. ä»£ç è¦†ç›–ç‡ > 80%
9. æ€§èƒ½åŸºå‡†æµ‹è¯•

**é¡¹ç›®ç»“æ„**:
```
advanced_math_lib/
â”œâ”€â”€ cmake/
â”‚   â”œâ”€â”€ FindBLAS.cmake
â”‚   â””â”€â”€ CompilerWarnings.cmake
â”œâ”€â”€ include/
â”‚   â””â”€â”€ advmath/
â”‚       â”œâ”€â”€ matrix.h
â”‚       â”œâ”€â”€ solver.h
â”‚       â””â”€â”€ optimizer.h
â”œâ”€â”€ src/
â”œâ”€â”€ tests/
â”œâ”€â”€ benchmarks/
â”œâ”€â”€ docs/
â”œâ”€â”€ examples/
â””â”€â”€ CMakeLists.txt
```

---

## å­¦ä¹ èµ„æºæ¨è

### å®˜æ–¹æ–‡æ¡£
- [CMake å®˜æ–¹æ–‡æ¡£](https://cmake.org/cmake/help/latest/)
- [CMake Wiki](https://gitlab.kitware.com/cmake/community/-/wikis/home)

### ä¹¦ç±
- "Professional CMake: A Practical Guide" by Craig Scott
- "CMake Cookbook" by Radovan Bast and Roberto Di Remigio

### åœ¨çº¿èµ„æº
- [Modern CMake](https://cliutils.gitlab.io/modern-cmake/)
- [Effective CMake](https://www.youtube.com/watch?v=bsXLMQ6WgIk)
- [CMake Examples](https://github.com/ttroy50/cmake-examples)

### å¼€æºé¡¹ç›®å­¦ä¹ 
- LLVM/Clang
- OpenCV
- Boost
- Qt

---

## å­¦ä¹ æ£€æŸ¥æ¸…å•

### ç°ä»£ CMake
- [ ] ç†è§£ç›®æ ‡å±æ€§ä¼ æ’­
- [ ] æŒæ¡ç”Ÿæˆå™¨è¡¨è¾¾å¼
- [ ] ä½¿ç”¨æ¥å£åº“
- [ ] æ­£ç¡®ä½¿ç”¨ target_* å‘½ä»¤

### ä¾èµ–ç®¡ç†
- [ ] ä½¿ç”¨ FetchContent
- [ ] ç¼–å†™ Find æ¨¡å—
- [ ] ç†è§£ Config æ¨¡å¼
- [ ] ç®¡ç†ä¾èµ–ç‰ˆæœ¬

### è·¨å¹³å°
- [ ] å¤„ç†å¹³å°å·®å¼‚
- [ ] ç¼–è¯‘å™¨é€‚é…
- [ ] åŠŸèƒ½æ£€æµ‹
- [ ] æ¡ä»¶ç¼–è¯‘

### åŒ…ç®¡ç†
- [ ] å¯¼å‡ºç›®æ ‡
- [ ] ç”Ÿæˆ Config æ–‡ä»¶
- [ ] ä½¿ç”¨ CPack
- [ ] ç‰ˆæœ¬ç®¡ç†

### é«˜çº§ç‰¹æ€§
- [ ] è‡ªå®šä¹‰å‘½ä»¤
- [ ] é¢„ç¼–è¯‘å¤´
- [ ] å¯¹è±¡åº“
- [ ] ä»£ç ç”Ÿæˆ

### å·¥ç¨‹åŒ–
- [ ] CI/CD é›†æˆ
- [ ] æ–‡æ¡£ç”Ÿæˆ
- [ ] ä»£ç è¦†ç›–ç‡
- [ ] æ€§èƒ½ä¼˜åŒ–

---

## æ€»ç»“

é€šè¿‡å®Œæˆè¿™äº›è¿›é˜¶æ”¹è¿›,ä½ å°†:

1. **æŒæ¡ç°ä»£ CMake æœ€ä½³å®è·µ**
2. **èƒ½å¤Ÿç®¡ç†å¤æ‚çš„ä¾èµ–å…³ç³»**
3. **ç¼–å†™è·¨å¹³å°çš„æ„å»ºé…ç½®**
4. **åˆ›å»ºå¯å¤ç”¨çš„åº“å’ŒåŒ…**
5. **ä½¿ç”¨ CMake çš„é«˜çº§ç‰¹æ€§**
6. **å»ºç«‹å®Œæ•´çš„å·¥ç¨‹åŒ–æµç¨‹**

**å»ºè®®å­¦ä¹ èŠ‚å¥**:
- æ¯ä¸ªé˜¶æ®µ 2-5 å¤©
- æ€»è®¡ 2-4 å‘¨å®Œæˆæ‰€æœ‰è¿›é˜¶å†…å®¹
- è¾¹å­¦è¾¹å®è·µ,ä¸è¦åªçœ‹ä¸åš

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
1. é€‰æ‹©ä¸€ä¸ªæ„Ÿå…´è¶£çš„é˜¶æ®µå¼€å§‹
2. é˜…è¯»ç›¸å…³æ–‡æ¡£å’Œç¤ºä¾‹
3. åœ¨é¡¹ç›®ä¸­å®è·µ
4. é‡åˆ°é—®é¢˜æŸ¥é˜…å®˜æ–¹æ–‡æ¡£
5. å®Œæˆåè¿›å…¥ä¸‹ä¸€é˜¶æ®µ

---

**ç¥ä½ åœ¨ CMake è¿›é˜¶å­¦ä¹ ä¸­å–å¾—æˆåŠŸ!** ğŸš€

*è®°ä½: çœŸæ­£çš„æŒæ¡æ¥è‡ªäºå®è·µå’Œé¡¹ç›®ç»éªŒ!*
